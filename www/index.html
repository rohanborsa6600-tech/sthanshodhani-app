<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover">
    <title>Sthanshodhani</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Gotu&family=Tiro+Devanagari+Marathi&display=swap" rel="stylesheet">

    <style>
        /* 1. рдмреЗрд╕рд┐рдХ рд╕реЗрдЯрд┐рдВрдЧреНрдЬ */
        body, html {
            margin: 0; padding: 0; 
            height: 100%; width: 100%;
            background-color: #000; 
            overflow: hidden;
            font-family: 'Gotu', sans-serif;
            -webkit-user-select: none; user-select: none;
        }

        /* 2. рдмреЕрдХрдЧреНрд░рд╛рдЙрдВрдб рдЗрдореЗрдЬ (рд╕реНрд╡рддрдГрдЪрд╛ рдлреЛрдЯреЛ) */
        #app-background {
            position: fixed; 
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100vw; height: 100vh;
            /* рдЗрдереЗ login_bg.png рд╡рд╛рдкрд░рд▓реЗ рдЖрд╣реЗ */
            background-image: url('login_bg.png'); 
            /* рдЬрд░ рдлреЛрдЯреЛ рдирд╕реЗрд▓ рддрд░ рдЗрдВрдЯрд░рдиреЗрдЯрд╡рд░реАрд▓ рдЗрдореЗрдЬ рджрд┐рд╕реЗрд▓ (рдмреЕрдХрдЕрдк) */
            background-image: url('login_bg.png'), url('https://images.unsplash.com/photo-1660721858662-9ad9f37447f7?q=80&w=1287&auto=format&fit=crop');
            background-size: cover; 
            background-position: center center;
            background-repeat: no-repeat;
            z-index: -1;
        }
        .dark-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.4); z-index: -1;
        }

        /* 3. Glass Panel Design */
        .glass-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border-radius: 20px;
        }

        /* 4. Login Screen */
        #login-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
            z-index: 1000;
        }

        .login-card {
            padding: 25px; width: 90%; max-width: 380px;
            text-align: center; color: white;
        }

        .app-title {
            font-family: 'Tiro Devanagari Marathi', serif;
            font-size: 34px; color: #FFD700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 15px;
        }

        /* Subtitle Styling */
        .app-quote {
            font-size: 13px; color: #fff; 
            font-style: italic; line-height: 1.6;
            margin-bottom: 30px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            border-left: 3px solid #FFD700;
            padding-left: 10px;
            text-align: left;
        }

        .glass-input {
            width: 100%; padding: 15px; margin-bottom: 20px;
            border: none; border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white; font-size: 16px; text-align: center; outline: none;
            box-sizing: border-box;
        }
        .glass-input::placeholder { color: rgba(255, 255, 255, 0.8); }

        .glass-btn {
            padding: 12px 40px; border-radius: 50px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: none; color: black; font-size: 18px; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        /* 5. Dashboard & Settings */
        #dashboard-screen { display: none; width: 100%; height: 100%; }
        #web-frame { width: 100%; height: 100%; border: none; background: white; }
        
        .floating-menu {
            position: absolute; top: 40px; right: 20px;
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            z-index: 500; cursor: pointer;
            background: #FFD700; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .menu-icon { font-size: 22px; color: black; }

        /* 6. Settings Modal (3 Tabs) */
        #settings-modal {
            display: none; position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000;
            justify-content: center; align-items: center;
        }
        .modal-content {
            width: 90%; max-width: 400px; max-height: 80%;
            display: flex; flex-direction: column;
            color: white; overflow: hidden;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid #FFD700;
        }
        
        /* Tabs Header */
        .tabs-header {
            display: flex; background: rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .tab-btn {
            flex: 1; padding: 15px 5px; text-align: center;
            font-size: 14px; cursor: pointer; color: #aaa;
            border-bottom: 3px solid transparent;
        }
        .tab-btn.active {
            color: #FFD700; border-bottom: 3px solid #FFD700; font-weight: bold;
        }

        /* Tab Content */
        .tab-content {
            padding: 20px; overflow-y: auto; flex-grow: 1;
            font-size: 14px; line-height: 1.6; color: #eee;
            text-align: left; display: none; /* Default hidden */
        }
        .tab-content.active { display: block; }

        h3 { color: #FFD700; margin-top: 0; border-bottom: 1px solid #555; padding-bottom: 5px; }
        ul { padding-left: 20px; }
        li { margin-bottom: 8px; }

        .close-btn {
            padding: 15px; text-align: center;
            background: #FFD700; color: black;
            font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="app-background"></div>
    <div class="dark-overlay"></div>

    <div id="login-screen">
        <div class="glass-panel login-card">
            <div class="app-title">рд╕реНрдерд╛рди рд╢реЛрдзрдиреА</div>
            
            <div class="app-quote">
                рд╕рд░реНрд╡реЗрд╢рд╛ рдкрджрд╕рдВрдЧрдореА рдорд╣рд┐рддрд│реА рддреАрд░реНрдерд╛рднрд┐рджрд╛ рдкрд╛рддрд▓реА<br>
               рдареЗрд╡реАрд▓реА рдирд┐рдЬрд╢рдХреНрддреА рддреА рдкреБрд░рд╡рд┐рддреА рд╕рддреНрдХрд╛рдордирд╛ рдЪрд┐рдВрддрд▓реА<br><br>
                рд╕реНрдерд╛рдирд╛рдЪрд╛ рдорд╣рд┐рдорд╛ рд╕реНрд╡рдпреЗ рдирд┐рд░реБрдкрд┐рд▓рд╛ рджреЗрд╡реЗ рд╕реНрд╡рднрдХреНрддрд╛рдВрдкреНрд░рддреА<br>
                рдереЛрд░реА рддреА рдЪрд╣реБрд╕рд╛рдзрдиреА рдЧрдгреБрдирд┐рдпрд╛ рднрд╛рд╡рд┐рдХрд╣реА рд╡рдВрджрд┐рддреА
          </div>

            <input type="text" id="username" class="glass-input" placeholder="рддреБрдордЪреЗ рдирд╛рд╡ рдЯрд╛рдХрд╛ eg.ADARSH" autocomplete="off">
            <button class="glass-btn" onclick="loginUser()">рдкреНрд░рд╡реЗрд╢ рдХрд░рд╛</button>
        </div>
    </div>

    <div id="dashboard-screen">
        <div class="floating-menu" onclick="toggleSettings()">
            <span class="menu-icon">тЪЩя╕П</span>
        </div>
        <iframe id="web-frame" src=""></iframe>
    </div>

    <div id="settings-modal">
        <div class="glass-panel modal-content">
            
            <div class="tabs-header">
                <div class="tab-btn active" onclick="switchTab('profile')">ЁЯСд рдкреНрд░реЛрдлрд╛рдИрд▓</div>
                <div class="tab-btn" onclick="switchTab('about')">тД╣я╕П рдЖрдордЪреНрдпрд╛рдмрджреНрджрд▓</div>
                <div class="tab-btn" onclick="switchTab('help')">тЭУ рдорджрдд</div>
            </div>

            <div id="tab-profile" class="tab-content active">
                <div style="text-align:center; padding-top:20px;">
                    <div style="font-size:60px;">ЁЯСд</div>
                    <h2 id="p-name" style="color:white; margin:10px 0;">User</h2>
                    <div style="color:#00ff00; font-weight:bold;">тЧП Status: Online</div>
                    <p style="color:#aaa; font-size:12px; margin-top:20px;">Device ID: <span id="p-uuid">...</span></p>
                </div>
            </div>

            <div id="tab-about" class="tab-content">
                <h3>рд╕реНрдерд╛рдирд╢реЛрдзрдиреА - рдПрдХ рдкрд╡рд┐рддреНрд░ рд╢реЛрдзрдпрд╛рддреНрд░рд╛</h3>
                <p>'рд╕реНрдерд╛рдирд╢реЛрдзрдиреА' рд╣реЗ ре▓рдк рдорд╣рд╛рдиреБрднрд╛рд╡ рдкрдВрдереАрдп рдЗрддрд┐рд╣рд╛рд╕, рд╕рдВрд╕реНрдХреГрддреА рдЖрдгрд┐ рддреАрд░реНрдерд╕реНрдерд╛рдирд╛рдВрдЪреНрдпрд╛ рдЕрднреНрдпрд╛рд╕рд╛рд▓рд╛ рд╕рдорд░реНрдкрд┐рдд рдЖрд╣реЗ. резрез рд╡реНрдпрд╛ рд╢рддрдХрд╛рддреАрд▓ рдкреНрд░рд╛рдЪреАрди рдЖрдгрд┐ рдорд╣рд╛рдиреБрднрд╛рд╡реАрдп рддреАрд░реНрдерд╕реНрдерд╛рдирд╛рдВрдЪреА рдкреБрд░рд╛рд╡реНрдпрд╛рдВрд╕рд╣рд┐рдд рдЖрдгрд┐ рд╕рдЪрд┐рддреНрд░ рдорд╛рд╣рд┐рддреА рд╕рд░реНрд╡ рднрд╛рд╡рд┐рдХ рдЖрдгрд┐ рдЕрднреНрдпрд╛рд╕рдХрд╛рдВрдкрд░реНрдпрдВрдд рдкреЛрд╣реЛрдЪрд╡рдгреЗ рд╣рд╛ рдЖрдордЪрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢ рдЖрд╣реЗ.</p>
                
                <h4 style="color:#FFD700; margin-bottom:5px;">рдпрд╛ ре▓рдкрдЪреА рд╡реИрд╢рд┐рд╖реНрдЯреНрдпреЗ:</h4>
                <ul>
                    <li><b>рдкреНрд░рд╛рдЪреАрди рддреАрд░реНрдерд╕реНрдерд╛рдиреЗ:</b> рдиреЗрд╡рд╛рд╕рд╛, рд╡реЗрд░реВрд│, рдкреИрдардг, рдбреЛрдВрдмреЗрдЧреНрд░рд╛рдо рдЖрдгрд┐ рдЗрддрд░ рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рд╕реНрдерд╛рдирд╛рдВрдЪреА рд╕рд╡рд┐рд╕реНрддрд░ рдорд╛рд╣рд┐рддреА.</li>
                    <li><b>рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рд╡рд╛рд░рд╕рд╛:</b> рд╕реНрдерд╛рдирд╛рдВрдЪреЗ рджреБрд░реНрдорд┐рд│ рдлреЛрдЯреЛ, рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдирдХрд╛рд╢реЗ (Historical Maps) рдЖрдгрд┐ рдкреБрд░рд╛рд╡реНрдпрд╛рдВрд╕рд╣рд┐рдд рдЖрд▓реЗрдЦ.</li>
                    <li><b>рейремреж┬░ рджрд░реНрд╢рди:</b> рдирд┐рд╡рдбрдХ рд╕реНрдерд╛рдирд╛рдВрдЪреЗ рдШрд░рдмрд╕рд▓реНрдпрд╛ рейремреж рдЕрдВрд╢рд╛рдордзреНрдпреЗ рджрд░реНрд╢рди рдШреЗрдгреНрдпрд╛рдЪреА рд╕реБрд╡рд┐рдзрд╛.</li>
                    <li><b>рд╕рдВрд╢реЛрдзрди:</b> рдЬреБрдиреНрдпрд╛ рдХрд╛рд│рд╛рддреАрд▓ 'рд╕реНрдерд╛рдирдкреЛрдереА' рдЖрдгрд┐ рдЖрдзреБрдирд┐рдХ рдХрд╛рд│рд╛рддреАрд▓ рднреМрдЧреЛрд▓рд┐рдХ рд╕реНрдерд╛рдирд╛рдВрдЪрд╛ рдореЗрд│ рдШрд╛рд▓рдгреНрдпрд╛рдЪрд╛ рдкреНрд░рдпрддреНрди.</li>
                </ul>
                <p style="text-align:center; color:#888; margin-top:15px; font-size:12px;">
                    рдирд┐рд░реНрдорд╛рддреЗ: рд╢реНрд░реА рджреЗрд╡рджрддреНрдд рдЖрд╢реНрд░рдо, рдЬрд╛рдзрд╡рд╡рд╛рдбреА.<br>┬й реирежреирей рд╕реНрдерд╛рдирд╢реЛрдзрдиреА
                </p>
            </div>

            <div id="tab-help" class="tab-content">
                <h3>ре▓рдк рдХрд╕реЗ рд╡рд╛рдкрд░рд╛рд╡реЗ?</h3>
                
                <p><b>рдЧрд╛рд╡реЗ рдЖрдгрд┐ рд╕реНрдерд╛рдиреЗ рд╢реЛрдзрдгреНрдпрд╛рд╕рд╛рдареА:</b><br>
                рддреБрдореНрд╣реА 'рдЧрд╛рд╡рд╛рдВрдЪреА рд╕реВрдЪреА' рдпрд╛ рдкрд░реНрдпрд╛рдпрд╛рд╡рд░ рдЬрд╛рдКрди рдЕрджреНрдпрд╛рдХреНрд╖рд░рд╛рдкреНрд░рдорд╛рдгреЗ (рдЕ, рдЖ, рдЗ...) рддреБрдордЪреНрдпрд╛ рдЖрд╡рдбреАрдЪреЗ рдЧрд╛рд╡ рдирд┐рд╡рдбреВ рд╢рдХрддрд╛ рдЖрдгрд┐ рддреЗрдереАрд▓ рд╕реНрдерд╛рдирд╛рдВрдЪреА рдорд╛рд╣рд┐рддреА рдорд┐рд│рд╡реВ рд╢рдХрддрд╛.</p>

                <p><b>рдирдХрд╛рд╢реЗ рдЖрдгрд┐ рдлреЛрдЯреЛ:</b><br>
                рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд╛рдирд╛рдЪреНрдпрд╛ рдкреЗрдЬрд╡рд░ рддреБрдореНрд╣рд╛рд▓рд╛ 'рдЧреЕрд▓рд░реА' рдЖрдгрд┐ 'рд╣рд┐рд╕реНрдЯреЙрд░рд┐рдХрд▓ рдореЕрдк' (рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдирдХрд╛рд╢реЗ) рдкрд╛рд╣рддрд╛ рдпреЗрддреАрд▓. рддрд╕реЗрдЪ 'рейремреж рдЯреВрд░' рдкрд░реНрдпрд╛рдпрд╛рд╡рд░ рдХреНрд▓рд┐рдХ рдХрд░реВрди рддреБрдореНрд╣реА рдкрд░рд┐рд╕рд░рд╛рдЪреЗ рдкреВрд░реНрдг рджрд░реНрд╢рди рдШреЗрдК рд╢рдХрддрд╛.</p>

                <div style="background:rgba(255,255,255,0.1); padding:10px; border-radius:10px; margin-top:15px;">
                    <b style="color:#FFD700;">рд╕рдВрдкрд░реНрдХ (Contact Us):</b><br>
                    рдЬрд░ рддреБрдореНрд╣рд╛рд▓рд╛ ре▓рдк рд╡рд╛рдкрд░рддрд╛рдирд╛ рдХрд╛рд╣реА рдЕрдбрдЪрдг рдпреЗрдд рдЕрд╕реЗрд▓, рдХрд┐рдВрд╡рд╛ рддреБрдореНрд╣рд╛рд▓рд╛ рдХрд╛рд╣реА рдирд╡реАрди рдорд╛рд╣рд┐рддреА/рд╕реБрдЪрд╡рдгреА рджреНрдпрд╛рдпрдЪреА рдЕрд╕реЗрд▓, рддрд░ рдХреГрдкрдпрд╛ рдЖрдореНрд╣рд╛рд▓рд╛ рдЦрд╛рд▓реАрд▓ рдИрдореЗрд▓рд╡рд░ рд╕рдВрдкрд░реНрдХ рд╕рд╛рдзрд╛.<br><br>
                    ЁЯУз <span style="color:#00ffff;">info@sthanshodhani.com</span>
                </div>
            </div>

            <div class="close-btn" onclick="toggleSettings()">рдмрдВрдж рдХрд░рд╛</div>
        </div>
    </div>

    <script src="cordova.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, update, onDisconnect, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAm_rgRbv0iih9gyPAtcnRKjzTV1An2IaU",
            authDomain: "sthanshodhani-62547.firebaseapp.com",
            databaseURL: "https://sthanshodhani-62547-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sthanshodhani-62547",
            appId: "1:327126466172:web:63c86dd1ad62b8b26553f9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let deviceUUID = "android_web_test"; 
        let deviceModel = "Browser";

        window.loginUser = loginUser;
        window.toggleSettings = toggleSettings;
        window.switchTab = switchTab;

        document.addEventListener('deviceready', onDeviceReady, false);

        function onDeviceReady() {
            deviceUUID = device.uuid;
            deviceModel = device.model;
            
            if(window.StatusBar) {
                StatusBar.overlaysWebView(true);
                StatusBar.styleLightContent();
            }
            checkLoginStatus();
        }

        function checkLoginStatus() {
            const savedName = localStorage.getItem("userName");
            if(savedName) {
                showDashboard(savedName);
            }
        }

        function loginUser() {
            const nameInput = document.getElementById("username").value;
            if(nameInput.trim() === "") {
                alert("рдХреГрдкрдпрд╛ рдирд╛рд╡ рдЯрд╛рдХрд╛");
                return;
            }
            localStorage.setItem("userName", nameInput);
            showDashboard(nameInput);
        }

        function showDashboard(userName) {
            document.getElementById("login-screen").style.display = "none";
            document.getElementById("dashboard-screen").style.display = "block";
            document.getElementById("web-frame").src = "https://sthanshodhani.com";
            
            document.getElementById("p-name").innerText = userName;
            document.getElementById("p-uuid").innerText = deviceUUID.substring(0, 8) + "...";

            startTracking(userName);
        }

        // --- Tabs Logic ---
        function switchTab(tabName) {
            // Remove active class from all
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            // Add active class to selected
            if(tabName === 'profile') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('tab-profile').classList.add('active');
            } else if (tabName === 'about') {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('tab-about').classList.add('active');
            } else if (tabName === 'help') {
                document.querySelectorAll('.tab-btn')[2].classList.add('active');
                document.getElementById('tab-help').classList.add('active');
            }
        }

        function toggleSettings() {
            const modal = document.getElementById("settings-modal");
            modal.style.display = (modal.style.display === "flex") ? "none" : "flex";
        }

        // --- Heartbeat Logic ---
        function startTracking(name) {
            const dateObj = new Date();
            const day = String(dateObj.getDate()).padStart(2, '0');
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const year = dateObj.getFullYear();
            const today = `${day}-${month}-${year}`;

            const userRef = ref(db, 'users/' + deviceUUID);
            const historyRef = ref(db, 'users/' + deviceUUID + '/history/' + today);

            get(historyRef).then((snapshot) => {
                let todayVisits = 0;
                let todayMinutes = 0;

                if (snapshot.exists()) {
                    const data = snapshot.val();
                    todayVisits = data.visits || 0;
                    todayMinutes = data.minutes || 0;
                }

                update(userRef, {
                    name: name,
                    model: deviceModel,
                    platform: "Android (App)",
                    status: "Online",
                    lastSeen: new Date().toLocaleTimeString(),
                    lastOnlineTimestamp: Date.now()
                });

                update(historyRef, {
                    visits: todayVisits + 1,
                    minutes: todayMinutes,
                    lastActive: new Date().toLocaleTimeString()
                });

                setInterval(() => {
                    get(historyRef).then((snap) => {
                        if(snap.exists()) {
                            let mins = snap.val().minutes || 0;
                            update(historyRef, { 
                                minutes: mins + 1,
                                lastActive: new Date().toLocaleTimeString()
                            });
                            update(userRef, { 
                                status: "Online",
                                lastOnlineTimestamp: Date.now()
                            });
                        }
                    });
                }, 60000);
            });

            onDisconnect(userRef).update({
                status: "Offline",
                lastSeen: new Date().toLocaleString()
            });
        }
    </script>
</body>
</html>
