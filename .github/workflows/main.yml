name: Build Sthanshodhani Final APK

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ‡§ï‡•ã‡§° ‡§ö‡•á‡§ï‡§Ü‡§â‡§ü ‡§ï‡§∞‡§£‡•á
      - uses: actions/checkout@v3

      # 2. Node.js ‡§Ü‡§£‡§ø Cordova ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§£‡•á
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - run: npm install -g cordova

      # 3. Java ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§£‡•á (Android ‡§∏‡§æ‡§†‡•Ä)
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # 4. Cordova ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§£‡•á ‡§Ü‡§£‡§ø ‡§™‡•ç‡§≤‡§ó‡§ø‡§®‡•ç‡§∏ ‡§ü‡§æ‡§ï‡§£‡•á
      - name: Create Cordova Project
        run: |
          # ‡§®‡§æ‡§µ ‡§¨‡§¶‡§≤‡§≤‡•á: Sthanshodhani
          cordova create myapp com.sthanshodhani.app "Sthanshodhani"
          cd myapp
          
          # Plugins (‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§°‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•á‡§ö)
          cordova plugin add cordova-plugin-statusbar
          cordova plugin add cordova-plugin-network-information
          cordova plugin add cordova-plugin-whitelist
          cordova plugin add cordova-plugin-device
          
          # üî• ‡§Æ‡§π‡§§‡•ç‡§§‡•ç‡§µ‡§æ‡§ö‡§æ ‡§¨‡§¶‡§≤: ‡§á‡§•‡•á @12.0.0 ‡§ï‡•á‡§≤‡•á ‡§Ü‡§π‡•á (‡§è‡§∞‡§∞ ‡§ò‡§æ‡§≤‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä)
          cordova platform add android@12.0.0
          cd ..

      # 5. Config.xml ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú (‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§¶‡§ø‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§°‡§Æ‡§ß‡•Ä‡§≤ LOGO ‡§≤‡•â‡§ú‡§ø‡§ï)
      - name: Configure App Settings
        run: |
          cd myapp
          
          # üî• 1. App Icon ‡§∏‡•á‡§ü ‡§ï‡§∞‡§£‡•á
          sed -i '/<widget/a <icon src="www/logo.png" />' config.xml
          
          # üî• 2. Splash Screen Logo (Android 12+)
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenAnimatedIcon" value="www/logo.png" />' config.xml
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenBackground" value="#000000" />' config.xml
          
          # Fullscreen ‡§Ü‡§£‡§ø Portrait Mode
          sed -i '/<widget/a <preference name="Fullscreen" value="true" />' config.xml
          sed -i '/<widget/a <preference name="Orientation" value="portrait" />' config.xml
          
          # Timeout ‡§µ‡§æ‡§¢‡§µ‡§£‡•á
          sed -i '/<widget/a <preference name="LoadUrlTimeoutValue" value="70000" />' config.xml
          cd ..

      # 6. ‡§´‡§æ‡§à‡§≤‡•ç‡§∏ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§£‡•á
      - name: Copy Files to WWW
        run: |
          # ‡§ú‡•Å‡§®‡•ç‡§Ø‡§æ ‡§°‡§ø‡§´‡•â‡§≤‡•ç‡§ü ‡§´‡§æ‡§à‡§≤‡•ç‡§∏ ‡§ï‡§æ‡§¢‡§£‡•á
          rm myapp/www/index.html
          rm -rf myapp/www/css
          rm -rf myapp/www/js
          
          # ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ www ‡§´‡•ã‡§≤‡•ç‡§°‡§∞‡§Æ‡§ß‡•Ä‡§≤ ‡§∏‡§∞‡•ç‡§µ ‡§´‡§æ‡§à‡§≤‡•ç‡§∏ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§£‡•á
          cp -r www/* myapp/www/
          
          # ‡§≤‡•ã‡§ó‡•ã ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡•â‡§™‡•Ä ‡§ù‡§æ‡§≤‡§æ ‡§®‡§æ ‡§Ø‡§æ‡§ö‡•Ä ‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§ï‡§∞‡§£‡•á
          cp www/logo.png myapp/www/ || true

      # 7. APK ‡§¨‡§ø‡§≤‡•ç‡§° ‡§ï‡§∞‡§£‡•á
      - name: Build APK
        run: |
          cd myapp
          cordova build android --debug

      # 8. APK ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•á
      - uses: actions/upload-artifact@v4
        with:
          name: Sthanshodhani-APK
          path: myapp/platforms/android/app/build/outputs/apk/debug/app-debug.apk
