name: Build Sthanshodhani Final APK

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. ‡§ï‡•ã‡§° ‡§ò‡•á‡§£‡•á
      - uses: actions/checkout@v3

      # 2. Node.js ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§£‡•á
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - run: npm install -g cordova

      # 3. Java 17 ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§£‡•á
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # 4. Cordova ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§£‡•á
      - name: Create Fresh Cordova Project
        run: |
          # ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ
          cordova create SthanshodhaniApp com.sthanshodhani.app "Sthanshodhani"
          cd SthanshodhaniApp
          
          # ‡§™‡•ç‡§≤‡§ó‡§á‡§®‡•ç‡§∏ ‡•≤‡§° ‡§ï‡§∞‡§æ
          cordova plugin add cordova-plugin-device
          cordova plugin add cordova-plugin-statusbar
          cordova plugin add cordova-plugin-whitelist
          
          # üî• ‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§Æ‡§π‡§§‡•ç‡§§‡•ç‡§µ‡§æ‡§ö‡§æ ‡§¨‡§¶‡§≤: Android 12.0.0 ‡§µ‡§æ‡§™‡§∞‡§æ (‡§π‡•á Java 17 ‡§≤‡§æ ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§§‡•á)
          cordova platform add android@12.0.0
          
          cd ..

      # 5. ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú ‡§Ü‡§£‡§ø ‡§≤‡•ã‡§ó‡•ã ‡§≤‡§æ‡§µ‡§£‡•á
      - name: Configure App Settings & Logo
        run: |
          cd SthanshodhaniApp
          
          # ‡§≤‡•ã‡§ó‡•ã ‡§∏‡•á‡§ü ‡§ï‡§∞‡§£‡•á (‡§π‡•á config.xml ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§Ø‡§ï‡•â‡§® ‡•≤‡§° ‡§ï‡§∞‡•á‡§≤)
          sed -i '/<widget/a <icon src="www/logo.png" />' config.xml
          
          # ‡§´‡•Å‡§≤ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§Æ‡•ã‡§°
          sed -i '/<widget/a <preference name="Fullscreen" value="true" />' config.xml
          
          # ‡§∏‡•ç‡§™‡•ç‡§≤‡•Ö‡§∂ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§´‡§ø‡§ï‡•ç‡§∏ (Android 12+)
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenAnimatedIcon" value="www/logo.png" />' config.xml
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenBackground" value="#000000" />' config.xml
          
          cd ..

      # 6. ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§´‡§æ‡§à‡§≤‡•ç‡§∏ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§£‡•á
      - name: Copy Files to WWW
        run: |
          # ‡§°‡§ø‡§´‡•â‡§≤‡•ç‡§ü ‡§´‡§æ‡§à‡§≤‡•ç‡§∏ ‡§π‡§ü‡§µ‡§£‡•á
          rm SthanshodhaniApp/www/index.html
          rm -rf SthanshodhaniApp/www/js
          rm -rf SthanshodhaniApp/www/css
          rm -rf SthanshodhaniApp/www/img

          # ‡§§‡•Å‡§Æ‡§ö‡•Ä www ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§£‡•á
          cp -r www/* SthanshodhaniApp/www/

      # 7. APK ‡§¨‡§ø‡§≤‡•ç‡§° ‡§ï‡§∞‡§£‡•á
      - name: Build APK
        run: |
          cd SthanshodhaniApp
          cordova build android --debug

      # 8. APK ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•á
      - uses: actions/upload-artifact@v4
        with:
          name: Sthanshodhani-App-APK
          path: SthanshodhaniApp/platforms/android/app/build/outputs/apk/debug/app-debug.apk
