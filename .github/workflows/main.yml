name: Build Sthanshodhani Final APK

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - run: npm install -g cordova

      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Create Cordova Project
        run: |
          cordova create myapp com.sthanshodhani.app "Sthanshodhani"
          cd myapp
          
          # Plugins
          cordova plugin add cordova-plugin-statusbar
          cordova plugin add cordova-plugin-whitelist
          cordova plugin add cordova-plugin-device
          
          # üî• ‡§π‡§æ‡§ö ‡§§‡•ã ‡§¨‡§¶‡§≤ (‡§π‡•Ä ‡§≤‡§æ‡§à‡§® ‡§∏‡•Ö‡§Æ‡•ç‡§™‡§≤‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ú‡•Å‡§®‡•Ä ‡§π‡•ã‡§§‡•Ä, ‡§Æ‡•Ä ‡§®‡§µ‡•Ä‡§® ‡§ü‡§æ‡§ï‡§≤‡•Ä ‡§Ü‡§π‡•á)
          cordova platform add android@12.0.0
          cd ..

      - name: Configure App Settings & Logo
        run: |
          cd myapp
          
          # üî• 1. LOGO ADD ‡§ï‡•á‡§≤‡§æ
          sed -i '/<widget/a <icon src="www/logo.png" />' config.xml
          
          # üî• 2. Splash Screen Logo
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenAnimatedIcon" value="www/logo.png" />' config.xml
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenBackground" value="#000000" />' config.xml
          
          # ‡§¨‡§æ‡§ï‡•Ä ‡§∏‡§∞‡•ç‡§µ ‡§ú‡•Å‡§®‡•ç‡§Ø‡§æ ‡§∏‡•Ö‡§Æ‡•ç‡§™‡§≤‡§∏‡§æ‡§∞‡§ñ‡•á‡§ö
          sed -i '/<widget/a <preference name="Fullscreen" value="true" />' config.xml
          sed -i '/<widget/a <preference name="Orientation" value="portrait" />' config.xml
          sed -i '/<widget/a <preference name="LoadUrlTimeoutValue" value="70000" />' config.xml
          
          cd ..

      - name: Copy Files to WWW
        run: |
          rm myapp/www/index.html
          rm -rf myapp/www/css
          rm -rf myapp/www/js
          
          # ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§´‡§æ‡§à‡§≤‡•ç‡§∏ ‡§Ü‡§£‡§ø ‡§≤‡•ã‡§ó‡•ã ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§£‡•á
          cp -r www/* myapp/www/
          cp www/logo.png myapp/www/ || true

      - name: Build APK
        run: |
          cd myapp
          cordova build android --debug

      - uses: actions/upload-artifact@v4
        with:
          name: Sthanshodhani-APK
          path: myapp/platforms/android/app/build/outputs/apk/debug/app-debug.apk
