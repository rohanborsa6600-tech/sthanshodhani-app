name: Build Sthanshodhani Final APK

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. рдХреЛрдб рдЪреЗрдХрдЖрдЙрдЯ рдХрд░рдгреЗ
      - uses: actions/checkout@v3

      # 2. Node.js рдЖрдгрд┐ Cordova рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдгреЗ
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - run: npm install -g cordova

      # 3. Java рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдгреЗ (Android рд╕рд╛рдареА)
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # 4. Cordova рдкреНрд░реЛрдЬреЗрдХреНрдЯ рддрдпрд╛рд░ рдХрд░рдгреЗ рдЖрдгрд┐ рдкреНрд▓рдЧрд┐рдиреНрд╕ рдЯрд╛рдХрдгреЗ
      - name: Create Cordova Project
        run: |
          # рдирд╛рд╡ рдмрджрд▓рд▓реЗ: Sthanshodhani
          cordova create myapp com.sthanshodhani.app "Sthanshodhani"
          cd myapp
          
          # Plugins (рддреБрдордЪреНрдпрд╛ рд╕реЕрдореНрдкрд▓ рдХреЛрдбрдкреНрд░рдорд╛рдгреЗ)
          cordova plugin add cordova-plugin-statusbar
          cordova plugin add cordova-plugin-network-information
          cordova plugin add cordova-plugin-whitelist
          # рдЯреНрд░реЕрдХрд┐рдВрдЧрд╕рд╛рдареА рд╣реЗ рдПрдХ рдПрдХреНрд╕реНрдЯреНрд░рд╛ рдкреНрд▓рдЧрдЗрди рд▓рд╛рдЧрддреЗ
          cordova plugin add cordova-plugin-device
          
          # Android Platform (рддреБрдордЪреНрдпрд╛ рд╕реЕрдореНрдкрд▓ рдХреЛрдбрдкреНрд░рдорд╛рдгреЗ - Version рдЯрд╛рдХрд▓реЗрд▓реЗ рдирд╛рд╣реА)
          cordova platform add android
          cd ..

      # 5. Config.xml рд╕реЗрдЯрд┐рдВрдЧреНрдЬ (рддреБрдореНрд╣реА рджрд┐рд▓реЗрд▓реНрдпрд╛ рдХреЛрдбрдордзреАрд▓ LOGO рд▓реЙрдЬрд┐рдХ)
      - name: Configure App Settings
        run: |
          cd myapp
          
          # ЁЯФе 1. App Icon рд╕реЗрдЯ рдХрд░рдгреЗ
          sed -i '/<widget/a <icon src="www/logo.png" />' config.xml
          
          # ЁЯФе 2. Splash Screen Logo (Android 12+)
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenAnimatedIcon" value="www/logo.png" />' config.xml
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenBackground" value="#000000" />' config.xml
          
          # Fullscreen рдЖрдгрд┐ Portrait Mode
          sed -i '/<widget/a <preference name="Fullscreen" value="true" />' config.xml
          sed -i '/<widget/a <preference name="Orientation" value="portrait" />' config.xml
          
          # Timeout рд╡рд╛рдврд╡рдгреЗ
          sed -i '/<widget/a <preference name="LoadUrlTimeoutValue" value="70000" />' config.xml
          cd ..

      # 6. рдлрд╛рдИрд▓реНрд╕ рдХреЙрдкреА рдХрд░рдгреЗ
      - name: Copy Files to WWW
        run: |
          # рдЬреБрдиреНрдпрд╛ рдбрд┐рдлреЙрд▓реНрдЯ рдлрд╛рдИрд▓реНрд╕ рдХрд╛рдврдгреЗ
          rm myapp/www/index.html
          rm -rf myapp/www/css
          rm -rf myapp/www/js
          
          # рддреБрдордЪреНрдпрд╛ www рдлреЛрд▓реНрдбрд░рдордзреАрд▓ рд╕рд░реНрд╡ рдлрд╛рдИрд▓реНрд╕ рдХреЙрдкреА рдХрд░рдгреЗ
          cp -r www/* myapp/www/
          
          # рд▓реЛрдЧреЛ рдирдХреНрдХреА рдХреЙрдкреА рдЭрд╛рд▓рд╛ рдирд╛ рдпрд╛рдЪреА рдЦрд╛рддреНрд░реА рдХрд░рдгреЗ
          cp www/logo.png myapp/www/ || true

      # 7. APK рдмрд┐рд▓реНрдб рдХрд░рдгреЗ
      - name: Build APK
        run: |
          cd myapp
          cordova build android --debug

      # 8. APK рдЕрдкрд▓реЛрдб рдХрд░рдгреЗ
      - uses: actions/upload-artifact@v4
        with:
          name: Sthanshodhani-APK
          path: myapp/platforms/android/app/build/outputs/apk/debug/app-debug.apk
