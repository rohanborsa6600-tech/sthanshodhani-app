name: Build Sthanshodhani APK

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§ï‡•ã‡§° ‡§ò‡•á‡§£‡•á
      - uses: actions/checkout@v3

      # 2. Node.js ‡§∏‡•á‡§ü ‡§ï‡§∞‡§£‡•á
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      
      # 3. Cordova ‡§ü‡•Ç‡§≤ ‡§ü‡§æ‡§ï‡§£‡•á
      - run: npm install -g cordova

      # 4. Java 17 ‡§ü‡§æ‡§ï‡§£‡•á
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # 5. ‡§®‡§µ‡•Ä‡§® ‡§´‡•ç‡§∞‡•á‡§∂ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§¨‡§®‡§µ‡§£‡•á
      - name: Create Fresh Cordova Project
        run: |
          cordova create SthanshodhaniApp com.sthanshodhani.app "Sthanshodhani"
          cd SthanshodhaniApp
          
          cordova plugin add cordova-plugin-device
          
          # üî• ‡§á‡§•‡•á ‡§´‡§ï‡•ç‡§§ @12.0.0 ‡§ï‡•á‡§≤‡•á ‡§Ü‡§π‡•á ‡§ú‡•á‡§£‡•á‡§ï‡§∞‡•Ç‡§® ‡§§‡•ã XmlParser ‡§è‡§∞‡§∞ ‡§Ø‡•á‡§£‡§æ‡§∞ ‡§®‡§æ‡§π‡•Ä
          cordova platform add android@12.0.0
          
          cd ..

      # 6. ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú ‡§Ü‡§£‡§ø ‡§≤‡•ã‡§ó‡•ã ‡§≤‡§æ‡§µ‡§£‡•á (‡§á‡§•‡•á ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§≤‡•ã‡§ó‡•ã‡§ö‡•ç‡§Ø‡§æ ‡§ì‡§≥‡•Ä ‡§ü‡§æ‡§ï‡§≤‡•ç‡§Ø‡§æ ‡§Ü‡§π‡•á‡§§)
      - name: Configure Settings & Logo
        run: |
          cd SthanshodhaniApp
          
          # üî• 1. ‡§π‡•Ä ‡§ì‡§≥ ‡§§‡•Å‡§Æ‡§ö‡§æ LOGO ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§≤
          sed -i '/<widget/a <icon src="www/logo.png" />' config.xml
          
          # üî• 2. ‡§π‡•á Android 12 ‡§µ‡§∞ ‡•≤‡§™ ‡§â‡§ò‡§°‡§§‡§æ‡§®‡§æ ‡§≤‡•ã‡§ó‡•ã ‡§¶‡§æ‡§ñ‡§µ‡•á‡§≤ (Splash Screen)
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenAnimatedIcon" value="www/logo.png" />' config.xml
          sed -i '/<widget/a <preference name="AndroidWindowSplashScreenBackground" value="#000000" />' config.xml

          # ‡§´‡•Å‡§≤ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§Æ‡•ã‡§°
          sed -i '/<widget/a <preference name="Fullscreen" value="true" />' config.xml
          # ‡§ì‡§µ‡•ç‡§π‡§∞‡§∏‡•ç‡§ï‡•ç‡§∞‡•ã‡§≤ ‡§¨‡§Ç‡§¶
          sed -i '/<widget/a <preference name="DisallowOverscroll" value="true" />' config.xml
          cd ..

      # 7. ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§´‡§æ‡§à‡§≤‡•ç‡§∏ ‡§®‡§µ‡•Ä‡§® ‡•≤‡§™‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ü‡§æ‡§ï‡§£‡•á
      - name: Copy User Files
        run: |
          rm SthanshodhaniApp/www/index.html
          rm -rf SthanshodhaniApp/www/js
          rm -rf SthanshodhaniApp/www/css
          rm -rf SthanshodhaniApp/www/img

          # ‡§§‡•Å‡§Æ‡§ö‡•Ä www ‡§´‡•ã‡§≤‡•ç‡§°‡§∞‡§ö‡•Ä ‡§∏‡§∞‡•ç‡§µ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§£‡•á
          cp -r www/* SthanshodhaniApp/www/

      # 8. APK ‡§´‡§æ‡§Ø‡§®‡§≤ ‡§¨‡§ø‡§≤‡•ç‡§° ‡§ï‡§∞‡§£‡•á
      - name: Build APK
        run: |
          cd SthanshodhaniApp
          cordova build android --debug

      # 9. APK ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•á
      - uses: actions/upload-artifact@v4
        with:
          name: Sthanshodhani-APK
          path: SthanshodhaniApp/platforms/android/app/build/outputs/apk/debug/app-debug.apk
